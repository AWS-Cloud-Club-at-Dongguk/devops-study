# 04. 처리율 제한 장치의 설계

- 처리율 제한 장치
    - 클라이언트 또는 서비스가 보내느 트래픽의 처리율을 제어하기 위한 장치
    - 예시: Http에서, 특정 기간 내 전송되는 클라이언트의 요청 횟수 제한
    - API 요청 횟수가 제한 장치에 정의된 임계치를 넘어서면, 추가로 도달한 모든 호출은 처리가 block됨

처리율 제한 사례
- 사용자는 초당 2회 이상 새 글을 올릴 수 없다.
- 같은 IP 주소로는 하루에 10개 이상의 계정을 생성할 수 없다.
- 같은 디바이스로는 주당 5회 이상 리워드를 요청할 수 없다.

- API에 처리율 제한 장치를 두면 좋은 점
  - DoS 공격에 의한 자원 고갈을 방지할 수 있다. 
    - 추가 요청에 대해서는 처리를 중단하기 때문
  - 비용 절감
    - 추가 요청에 대한 처리를 제한하기 때문에
        - 서버를 많이 두지 않아도 됨
        - 우선순위가 더 높은 API에 더 많은 자원을 할당할 수 있다
        - 제3자(third party) API에 사용료를 지불하고 있는 경우, 그 API를 호출하는 횟수에 제한을 두는 것은 비용 절감에 도움이 됨 
  - 서버 과부하 방지
    - 봇에서 오는 트래픽이나 사용자의 잘못된 이용으로 유발된 트래픽을 걸러내는 데 처리율 제한 장치를 활용할 수 있다.

## 1. 문제 이해 및 설계 범위 확정
면접관과 소통해서 어떤 제한 장치를 구현해야 하는지를 분명히 하고, 그 목적에 맞는 알고리즘을 선택

- 면접관과의 질문 예시
  - 클라이언트 측 제한 장치인지, 서버 측 제한 장치인지
  - API 호출 제어 기준? IP 주소, 사용자 ID 등
  - 시스템 규모
  - 분산 환경 동작 여부
  - 독립된 서비스인지 아니면 애플리케이션 코드에 포함되는지
  - 사용자의 요청이 처리율 제한 장치에 의해 걸러진 경우 사용자에게 그 사실을 알려야 하는지?

- 시스템 요구사항
  - 설정된 처리율을 초과하는 요청은 정확하게 제한
  - 낮은 응답시간: 처리율 제한 장치는 HTTP 응답시간에 나쁜 영향을 주어서는 안된다.
  - 가능한 한 적은 메모리 사용하기
  - 분산형 처리율 제한: 하나의 처리율 제한 장치를, 여러 서버나 프로세스에서 공유할 수 있어야 한다.
  - 예외 처리: 요청이 제한되었을 때는 그 사실을 사용자에게 보여주어야 한다.
  - 제한 장치에 장애가 생기더라도 전체 시스템에 영향을 주어서는 안된다.

## 2. 개략적 설계안 제시 및 동의 구하기
클라이언트-서버 통신 모델 예시로 생각

- 처리율 제한 장치는 어디에 둘 것인가?
  - 클라이언트 측에 둔다면
    - 클라이언트 요청은 쉽게 위변조가 가능하고, 모든 클라이언트의 구현을 통제하는 것이 어렵기 때문에, 클라이언트는 일반적으로 처리율 제한을 안정적으로 걸 수 있는 장소는 아님
  - 서버 측에 둔다면
    - 